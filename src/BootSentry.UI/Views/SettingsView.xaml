<Window x:Class="BootSentry.UI.Views.SettingsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:res="clr-namespace:BootSentry.UI.Resources"
        mc:Ignorable="d"
        Title="{res:Localize SettingsWindowTitle}"
        Height="550" Width="500"
        MinHeight="450" MinWidth="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource WindowBackground}"
        KeyDown="Window_KeyDown"
        FocusManager.FocusedElement="{Binding ElementName=CloseButton}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                   Text="{res:Localize SettingsTitle}"
                   FontSize="24" FontWeight="Bold"
                   Foreground="{DynamicResource WindowForeground}"/>

        <!-- Settings Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,16,0,0">
            <StackPanel>
                <!-- General Section -->
                <TextBlock Text="{res:Localize SettingsGeneral}" Style="{StaticResource SectionHeader}"/>

                <Grid Margin="0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="150"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="{res:Localize SettingsLanguage}" Style="{StaticResource SettingLabel}"/>
                        <TextBlock Text="{res:Localize SettingsLanguageHint}" Style="{StaticResource SettingDescription}"/>
                    </StackPanel>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding Languages}"
                              SelectedValue="{Binding SelectedLanguage}"
                              SelectedValuePath="Code"
                              DisplayMemberPath="Name"
                              Height="38"
                              HorizontalAlignment="Stretch"/>
                </Grid>

                <CheckBox Content="{res:Localize SettingsExpertDefault}"
                          IsChecked="{Binding IsExpertModeDefault}"
                          Foreground="{DynamicResource WindowForeground}"
                          Margin="0,8"/>

                <CheckBox Content="{res:Localize SettingsCheckUpdates}"
                          IsChecked="{Binding CheckForUpdatesOnStartup}"
                          Foreground="{DynamicResource WindowForeground}"
                          Margin="0,8"/>

                <CheckBox Content="{res:Localize SettingsShowOnboarding}"
                          IsChecked="{Binding ShowOnboarding}"
                          Foreground="{DynamicResource WindowForeground}"
                          Margin="0,8"/>

                <!-- Appearance Section -->
                <TextBlock Text="{res:Localize SettingsAppearance}" Style="{StaticResource SectionHeader}"/>

                <Grid Margin="0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="150"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="{res:Localize SettingsTheme}" Style="{StaticResource SettingLabel}"/>
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding Themes}"
                              SelectedValue="{Binding SelectedTheme}"
                              SelectedValuePath="Mode"
                              DisplayMemberPath="Name"
                              Height="38"
                              HorizontalAlignment="Stretch"/>
                </Grid>

                <!-- Theme Preview -->
                <Border Background="{DynamicResource PanelBackground}"
                        BorderBrush="{DynamicResource BorderBrush}"
                        BorderThickness="1" CornerRadius="6"
                        Padding="12" Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="{res:Localize ThemePreview}" FontWeight="SemiBold"
                                   Foreground="{DynamicResource WindowForeground}" Margin="0,0,0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4">
                            <Border Width="24" Height="24" CornerRadius="4" Margin="0,0,8,0"
                                    Background="{DynamicResource AccentBrush}" ToolTip="{res:Localize ThemePreviewAccent}"/>
                            <Border Width="24" Height="24" CornerRadius="4" Margin="0,0,8,0"
                                    Background="{DynamicResource SuccessBrush}" ToolTip="{res:Localize ThemePreviewSuccess}"/>
                            <Border Width="24" Height="24" CornerRadius="4" Margin="0,0,8,0"
                                    Background="{DynamicResource WarningBrush}" ToolTip="{res:Localize ThemePreviewWarning}"/>
                            <Border Width="24" Height="24" CornerRadius="4" Margin="0,0,8,0"
                                    Background="{DynamicResource ErrorBrush}" ToolTip="{res:Localize ThemePreviewError}"/>
                            <Border Width="24" Height="24" CornerRadius="4" Margin="0,0,8,0"
                                    Background="{DynamicResource NeutralBrush}" ToolTip="{res:Localize ThemePreviewNeutral}"/>
                        </StackPanel>
                        <Grid Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Content="{res:Localize ThemePreviewPrimaryButton}" Margin="0,0,4,0"
                                    Background="{DynamicResource AccentBrush}"
                                    Foreground="{DynamicResource AccentForeground}"
                                    Padding="8,4" IsEnabled="False"/>
                            <Button Grid.Column="1" Content="{res:Localize ThemePreviewSecondaryButton}" Margin="4,0,0,0"
                                    Style="{StaticResource SecondaryButton}"
                                    Padding="8,4" IsEnabled="False"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Backup Section -->
                <TextBlock Text="{res:Localize SettingsBackups}" Style="{StaticResource SectionHeader}"/>

                <Grid Margin="0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock x:Name="BackupRetentionLabel" Text="{res:Localize SettingsBackupRetention}" Style="{StaticResource SettingLabel}"/>
                        <TextBlock Text="{res:Localize SettingsBackupHint}" Style="{StaticResource SettingDescription}"/>
                    </StackPanel>
                    <TextBox Grid.Column="1"
                             Text="{Binding BackupRetentionDays, UpdateSourceTrigger=PropertyChanged}"
                             VerticalAlignment="Center"
                             HorizontalContentAlignment="Center"
                             PreviewTextInput="NumericTextBox_PreviewTextInput"
                             AutomationProperties.LabeledBy="{Binding ElementName=BackupRetentionLabel}"/>
                    <TextBlock Grid.Column="2" Text="{res:Localize SettingsDays}"
                               Style="{StaticResource SettingLabel}"
                               Margin="4,0,0,0"/>
                </Grid>

                <!-- Advanced Section -->
                <TextBlock Text="{res:Localize SettingsAdvanced}" Style="{StaticResource SectionHeader}"/>

                <CheckBox Content="{res:Localize SettingsAutoHash}"
                          IsChecked="{Binding AutoCalculateHashes}"
                          Foreground="{DynamicResource WindowForeground}"
                          Margin="0,8"/>

                <TextBlock Text="{res:Localize SettingsAutoHashWarning}"
                           Style="{StaticResource SettingDescription}"
                           Margin="20,0,0,0"/>

                <!-- Danger Zone -->
                <TextBlock Text="{res:Localize SettingsDangerZone}" Style="{StaticResource SectionHeader}"
                           Foreground="{DynamicResource ErrorBrush}"/>

                <Button Content="{res:Localize SettingsResetButton}"
                        Command="{Binding ResetToDefaultsCommand}"
                        Padding="12,8"
                        Margin="0,8"
                        HorizontalAlignment="Left"
                        Background="{DynamicResource ControlBackground}"
                        Foreground="{DynamicResource ControlForeground}"
                        BorderBrush="{DynamicResource BorderBrush}"/>

                <Button Content="{res:Localize SettingsPurgeData}"
                        Command="{Binding PurgeAllDataCommand}"
                        Padding="12,8"
                        Margin="0,8"
                        HorizontalAlignment="Left"
                        Background="{DynamicResource ErrorBrush}"
                        Foreground="White"
                        BorderThickness="0"/>

                <TextBlock Text="{res:Localize SettingsPurgeHint}"
                           Style="{StaticResource SettingDescription}"
                           Foreground="{DynamicResource ErrorBrush}"
                           Margin="0,0,0,16"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Grid Grid.Row="2" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="{Binding StatusMessage}"
                       Foreground="{DynamicResource DisabledForeground}"
                       VerticalAlignment="Center"/>

            <Button x:Name="CloseButton"
                    Grid.Column="1"
                    Content="{res:Localize Close}"
                    Click="CloseButton_Click"
                    IsDefault="True"
                    Padding="24,8"
                    Background="{DynamicResource AccentBrush}"
                    Foreground="{DynamicResource AccentForeground}"
                    BorderThickness="0"/>
        </Grid>
    </Grid>
</Window>
