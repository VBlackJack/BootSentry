<Window x:Class="BootSentry.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:BootSentry.UI.ViewModels"
        mc:Ignorable="d"
        Title="BootSentry - Gestionnaire de dÃ©marrage Windows"
        Height="700" Width="1100"
        MinHeight="500" MinWidth="800"
        WindowStartupLocation="CenterScreen">

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" Command="{Binding SearchCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding ToggleExpertModeCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="BootSentry" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text=" - Gestionnaire de dÃ©marrage" FontSize="14" Foreground="#CCFFFFFF"
                               VerticalAlignment="Bottom" Margin="8,0,0,4"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <ToggleButton Content="Mode Expert"
                                  IsChecked="{Binding IsExpertMode}"
                                  Padding="12,6" Margin="8,0"
                                  Background="Transparent" Foreground="White"
                                  BorderBrush="White" BorderThickness="1"/>
                    <Button Content="âš™" ToolTip="ParamÃ¨tres" Padding="8,6"
                            Background="Transparent" Foreground="White"
                            Command="{Binding OpenSettingsCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="#F5F5F5" Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Content="ðŸ”„ Actualiser" Command="{Binding RefreshCommand}"
                            Background="#0078D4" ToolTip="Actualiser (F5)"/>
                    <Button Content="â¸ DÃ©sactiver" Command="{Binding DisableSelectedCommand}"
                            Background="#FF8C00"/>
                    <Button Content="â–¶ Activer" Command="{Binding EnableSelectedCommand}"
                            Background="#107C10"/>
                    <Button Content="ðŸ—‘ Supprimer" Command="{Binding DeleteSelectedCommand}"
                            Background="#D13438"
                            Visibility="{Binding IsExpertMode, Converter={StaticResource BoolToVisibility}}"/>
                </StackPanel>

                <TextBox Grid.Column="1"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Margin="16,0"
                         Padding="8,4"
                         VerticalContentAlignment="Center">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Style.Triggers>
                                <Trigger Property="Text" Value="">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <VisualBrush Stretch="None" AlignmentX="Left">
                                                <VisualBrush.Visual>
                                                    <TextBlock Text="ðŸ” Rechercher..." Foreground="Gray" Margin="4,0"/>
                                                </VisualBrush.Visual>
                                            </VisualBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">
                        <Run Text="{Binding VisibleEntriesCount, Mode=OneWay}"/>
                        <Run Text=" entrÃ©es"/>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="350" MinWidth="250"/>
            </Grid.ColumnDefinitions>

            <!-- Entry List -->
            <DataGrid Grid.Column="0"
                      ItemsSource="{Binding FilteredEntries}"
                      SelectedItem="{Binding SelectedEntry}"
                      Margin="8">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Nom" Binding="{Binding DisplayName}" Width="*"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                    <DataGridTextColumn Header="Ã‰diteur" Binding="{Binding Publisher}" Width="150"/>
                    <DataGridTextColumn Header="Statut" Binding="{Binding Status}" Width="80"/>
                    <DataGridTemplateColumn Header="Risque" Width="70">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Ellipse Width="12" Height="12" Margin="4">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding RiskLevel}" Value="Safe">
                                                    <Setter Property="Fill" Value="{StaticResource RiskSafeBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding RiskLevel}" Value="Unknown">
                                                    <Setter Property="Fill" Value="{StaticResource RiskUnknownBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding RiskLevel}" Value="Suspicious">
                                                    <Setter Property="Fill" Value="{StaticResource RiskSuspiciousBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding RiskLevel}" Value="Critical">
                                                    <Setter Property="Fill" Value="{StaticResource RiskCriticalBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center"
                          VerticalAlignment="Stretch" Background="#E0E0E0"/>

            <!-- Details Panel -->
            <Border Grid.Column="2" Background="#FAFAFA" Padding="16" Margin="0,8,8,8">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="DÃ©tails" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>

                        <TextBlock Text="Aucune entrÃ©e sÃ©lectionnÃ©e"
                                   Visibility="{Binding SelectedEntry, Converter={StaticResource NullToVisibility}}"
                                   Foreground="Gray" FontStyle="Italic"/>

                        <StackPanel Visibility="{Binding SelectedEntry, Converter={StaticResource NotNullToVisibility}}">
                            <TextBlock Text="{Binding SelectedEntry.DisplayName}"
                                       FontSize="16" FontWeight="SemiBold" TextWrapping="Wrap"/>

                            <Separator Margin="0,12"/>

                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Type:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedEntry.Type}" TextWrapping="Wrap"/>
                            </Grid>

                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Source:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedEntry.SourcePath}" TextWrapping="Wrap"/>
                            </Grid>

                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Cible:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedEntry.TargetPath}" TextWrapping="Wrap"/>
                            </Grid>

                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Ã‰diteur:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedEntry.Publisher}" TextWrapping="Wrap"/>
                            </Grid>

                            <Grid Margin="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Signature:" FontWeight="SemiBold"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedEntry.SignatureStatus}" TextWrapping="Wrap"/>
                            </Grid>

                            <Separator Margin="0,12"/>

                            <TextBlock Text="Commande:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                            <TextBox Text="{Binding SelectedEntry.CommandLineRaw, Mode=OneWay}"
                                     IsReadOnly="True" TextWrapping="Wrap"
                                     Background="#F0F0F0" Padding="8"/>

                            <Separator Margin="0,12"/>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Content="ðŸ“‚ Ouvrir l'emplacement" Command="{Binding OpenFileLocationCommand}"
                                        Margin="4" Background="#6B6B6B"/>
                                <Button Content="ðŸ“‹ Copier le chemin" Command="{Binding CopyPathCommand}"
                                        Margin="4" Background="#6B6B6B"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#E0E0E0" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" Margin="16,0">
                        <Run Text="Actives: "/>
                        <Run Text="{Binding EnabledCount, Mode=OneWay}" FontWeight="SemiBold"/>
                    </TextBlock>
                    <TextBlock VerticalAlignment="Center" Margin="16,0">
                        <Run Text="DÃ©sactivÃ©es: "/>
                        <Run Text="{Binding DisabledCount, Mode=OneWay}" FontWeight="SemiBold"/>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
